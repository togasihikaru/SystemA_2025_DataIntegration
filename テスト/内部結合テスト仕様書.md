# 内部結合テスト仕様書

## 1. 文書情報

| 項目 | 内容 |
|------|------|
| 文書名 | 内部結合テスト仕様書 |
| システム名 | SystemA_2025_DataIntegration |
| バージョン | 1.0 |
| 作成日 | 2025年1月 |
| 作成者 | - |
| 承認者 | - |

## 2. テスト概要

### 2.1 テスト目的
本システムの各モジュール間の連携が正常に動作することを確認する。

### 2.2 テスト対象システム
- **Managementプロジェクト**: Windows Formsアプリケーション（売上データ管理、送受信ログ管理）
- **Batchプロジェクト**: コンソールアプリケーション（売上データ送信バッチ）

### 2.3 テスト範囲
- Top画面と各機能画面（SalesData、Transmission）の画面遷移
- SalesData画面とTransmissionクラスのデータ連携
- SalesData画面とBatchプロセスの連携
- データベース接続機能（Transmissionクラス）
- エラーハンドリングとログ出力

### 2.4 テスト環境
- OS: Windows 10以上
- .NET Framework: .NET 8.0
- データベース: SQL Server（接続文字列設定時）
- 開発環境: Visual Studio 2022

## 3. テスト項目一覧

### 3.1 画面遷移テスト

#### テストケース ID: IT-001
**テスト項目名**: Top画面からSalesData画面への遷移

| 項目 | 内容 |
|------|------|
| 前提条件 | Managementアプリケーションが起動し、Top画面が表示されている |
| テスト手順 | 1. Top画面の「売り上げ管理」ボタンをクリック<br>2. SalesData画面が表示されることを確認<br>3. Top画面が非表示になることを確認 |
| 期待結果 | - SalesData画面が正常に表示される<br>- Top画面が非表示になる<br>- SalesData画面を閉じるとTop画面が再表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-002
**テスト項目名**: Top画面からTransmission画面への遷移

| 項目 | 内容 |
|------|------|
| 前提条件 | Managementアプリケーションが起動し、Top画面が表示されている |
| テスト手順 | 1. Top画面の「button2」（送受信ログ）ボタンをクリック<br>2. Transmission画面が表示されることを確認<br>3. Top画面が非表示になることを確認 |
| 期待結果 | - Transmission画面が正常に表示される<br>- Top画面が非表示になる<br>- Transmission画面を閉じるとTop画面が再表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

### 3.2 SalesData画面機能テスト

#### テストケース ID: IT-003
**テスト項目名**: SalesData画面の初期表示

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている |
| テスト手順 | 1. SalesData画面の初期状態を確認 |
| 期待結果 | - 開始期間・終了期間が現在の年月（yyyy/MM形式）で表示される<br>- 商品分類のチェックボックスがすべてチェックされている<br>- 商品番号・商品名の入力欄が空欄である<br>- DataGridViewが初期化されている（15行分の空行）<br>- 「送信」「更新」ボタンが無効化されている |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-004
**テスト項目名**: 売上データ検索（正常系）

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている<br>データベースにテストデータが存在する（または接続文字列未設定でサンプルデータが返る） |
| テスト手順 | 1. 開始期間に「2024/01」を入力<br>2. 終了期間に「2024/12」を入力<br>3. 商品分類を1つ以上選択<br>4. 「検索」ボタンをクリック |
| 期待結果 | - エラーメッセージが表示されない<br>- DataGridViewに検索結果が表示される<br>- 「送信」「更新」ボタンが有効化される<br>- データが正しく表示される（販売日時、分類、商品番号、商品名、売上数量、割引適用額、売上額） |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-005
**テスト項目名**: 売上データ検索（入力チェック：期間形式エラー）

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている |
| テスト手順 | 1. 開始期間に「2024-01」を入力（不正な形式）<br>2. 終了期間に「2024/12」を入力<br>3. 「検索」ボタンをクリック |
| 期待結果 | - 「期間は 'yyyy/MM' 形式で入力してください。」というエラーメッセージが表示される<br>- 検索が実行されない |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-006
**テスト項目名**: 売上データ検索（入力チェック：商品分類未選択）

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている |
| テスト手順 | 1. すべての商品分類のチェックを外す<br>2. 「検索」ボタンをクリック |
| 期待結果 | - 「商品分類を一つ以上選択してください。」というエラーメッセージが表示される<br>- 検索が実行されない |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-007
**テスト項目名**: 売上データ検索（入力チェック：商品番号形式エラー）

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている |
| テスト手順 | 1. 商品番号に「12345A」（6桁以上または非数値）を入力<br>2. 「検索」ボタンをクリック |
| 期待結果 | - 「商品番号は半角数値で5桁以下で入力してください。」というエラーメッセージが表示される<br>- 検索が実行されない |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-008
**テスト項目名**: 売上データ検索（入力チェック：商品名文字数超過）

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている |
| テスト手順 | 1. 商品名に31文字以上の文字列を入力<br>2. 「検索」ボタンをクリック |
| 期待結果 | - 「商品名は30文字以下で入力してください。」というエラーメッセージが表示される<br>- 検索が実行されない |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-009
**テスト項目名**: 条件クリア機能

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている<br>検索条件が入力されている |
| テスト手順 | 1. 開始期間・終了期間に任意の値を入力<br>2. 商品分類のチェックを一部外す<br>3. 商品番号・商品名に任意の値を入力<br>4. 「条件クリア」ボタンをクリック |
| 期待結果 | - 開始期間・終了期間が現在の年月にリセットされる<br>- すべての商品分類がチェックされる<br>- 商品番号・商品名がクリアされる |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-010
**テスト項目名**: 売上データ送信機能

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている<br>検索が実行され、データが表示されている |
| テスト手順 | 1. 「送信」ボタンをクリック<br>2. 確認メッセージで「はい」を選択<br>3. バッチ処理の実行結果を確認 |
| 期待結果 | - 確認メッセージが表示される<br>- バッチ処理が正常に実行される（リターンコード0）<br>- 「売上データの送信が完了しました。」というメッセージが表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-011
**テスト項目名**: 売上データ送信機能（キャンセル）

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている<br>検索が実行され、データが表示されている |
| テスト手順 | 1. 「送信」ボタンをクリック<br>2. 確認メッセージで「いいえ」を選択 |
| 期待結果 | - 確認メッセージが表示される<br>- バッチ処理が実行されない<br>- 画面がそのまま表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-012
**テスト項目名**: 更新機能

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている<br>検索が実行され、データが表示されている |
| テスト手順 | 1. 「更新」ボタンをクリック |
| 期待結果 | - 検索処理が再実行される<br>- 最新のデータが表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

### 3.3 Transmission画面機能テスト

#### テストケース ID: IT-013
**テスト項目名**: Transmission画面の初期表示

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている |
| テスト手順 | 1. Transmission画面の初期状態を確認 |
| 期待結果 | - 開始期間・終了期間が現在の年月（yyyy/MM形式）で表示される<br>- 分類・ステータスのチェックボックスがすべてチェックされている<br>- DataGridViewが初期化されている<br>- 「更新」ボタンが無効化されている |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-014
**テスト項目名**: 送受信ログ検索（正常系）

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている<br>データベースにテストデータが存在する（または接続文字列未設定でサンプルデータが返る） |
| テスト手順 | 1. 開始期間に「2024/01」を入力<br>2. 終了期間に「2024/12」を入力<br>3. 分類・ステータスを1つ以上選択<br>4. 「検索」ボタンをクリック |
| 期待結果 | - エラーメッセージが表示されない<br>- DataGridViewに検索結果が表示される<br>- 「更新」ボタンが有効化される<br>- データが正しく表示される（処理日時、分類、ステータス、ファイル名、商品番号、商品名、件数）<br>- 横スクロールが発生せず、列幅が調整されている |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-015
**テスト項目名**: 送受信ログ検索（入力チェック：期間形式エラー）

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている |
| テスト手順 | 1. 開始期間に「2024-01」を入力（不正な形式）<br>2. 終了期間に「2024/12」を入力<br>3. 「検索」ボタンをクリック |
| 期待結果 | - 「期間は 'yyyy/MM' 形式で入力してください。単月は開始と終了を同じ年月にしてください。」というエラーメッセージが表示される<br>- 検索が実行されない |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-016
**テスト項目名**: 送受信ログ検索（入力チェック：分類・ステータス未選択）

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている |
| テスト手順 | 1. すべての分類・ステータスのチェックを外す<br>2. 「検索」ボタンをクリック |
| 期待結果 | - 「分類/ステータスを一つ以上選択してください。」というエラーメッセージが表示される<br>- 検索が実行されない |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-017
**テスト項目名**: 条件クリア機能

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている<br>検索条件が入力されている |
| テスト手順 | 1. 開始期間・終了期間に任意の値を入力<br>2. 分類・ステータスのチェックを一部外す<br>3. 「条件クリア」ボタンをクリック |
| 期待結果 | - 開始期間・終了期間が現在の年月にリセットされる<br>- すべての分類・ステータスがチェックされる<br>- DataGridViewがクリアされる |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-018
**テスト項目名**: 更新機能

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている<br>検索が実行され、データが表示されている |
| テスト手順 | 1. 「更新」ボタンをクリック |
| 期待結果 | - 検索処理が再実行される<br>- 最新のデータが表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

### 3.4 データ連携テスト

#### テストケース ID: IT-019
**テスト項目名**: SalesData画面とTransmissionクラスのデータ連携

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている<br>TransmissionクラスのGetSalesDataメソッドが実装されている |
| テスト手順 | 1. SalesData画面で検索条件を入力<br>2. 「検索」ボタンをクリック<br>3. TransmissionクラスのGetSalesDataメソッドが呼び出されることを確認<br>4. 取得したデータがSalesData画面に表示されることを確認 |
| 期待結果 | - TransmissionクラスのGetSalesDataメソッドが正常に呼び出される<br>- データが正しい形式で取得される<br>- SalesData画面にデータが正しく表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-020
**テスト項目名**: SalesData画面とBatchプロセスの連携

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面が表示されている<br>検索が実行され、データが表示されている<br>Batch.exeが存在する |
| テスト手順 | 1. 「送信」ボタンをクリック<br>2. 確認メッセージで「はい」を選択<br>3. StartBatchProcessメソッドが呼び出されることを確認<br>4. Batchプロセスが起動されることを確認<br>5. リターンコードが取得されることを確認 |
| 期待結果 | - StartBatchProcessメソッドが正常に呼び出される<br>- Batchプロセスが正常に起動される<br>- リターンコードが正しく取得される<br>- リターンコードに応じたメッセージが表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

### 3.5 データベース接続テスト

#### テストケース ID: IT-021
**テスト項目名**: データベース接続（接続文字列設定時）

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている<br>接続文字列が設定されている<br>データベースサーバーが起動している |
| テスト手順 | 1. 検索条件を入力<br>2. 「検索」ボタンをクリック<br>3. データベース接続が確立されることを確認<br>4. データが取得されることを確認 |
| 期待結果 | - データベース接続が正常に確立される<br>- SQLクエリが正常に実行される<br>- データが正しく取得される<br>- エラーが発生しない |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-022
**テスト項目名**: データベース接続（接続文字列未設定時：サンプルデータ）

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている<br>接続文字列が空文字列に設定されている |
| テスト手順 | 1. 検索条件を入力<br>2. 「検索」ボタンをクリック<br>3. サンプルデータが返されることを確認 |
| 期待結果 | - データベース接続が試行されない<br>- サンプルデータが返される<br>- データが正しく表示される<br>- エラーが発生しない |
| 判定基準 | 上記の期待結果がすべて満たされること |

#### テストケース ID: IT-023
**テスト項目名**: データベース接続エラー処理

| 項目 | 内容 |
|------|------|
| 前提条件 | Transmission画面が表示されている<br>接続文字列が設定されている<br>データベースサーバーが停止している、または接続できない状態 |
| テスト手順 | 1. 検索条件を入力<br>2. 「検索」ボタンをクリック |
| 期待結果 | - データベース接続エラーが発生する<br>- エラーメッセージが表示される<br>- エラーログが記録される<br>- アプリケーションが異常終了しない |
| 判定基準 | 上記の期待結果がすべて満たされること |

### 3.6 エラーハンドリングテスト

#### テストケース ID: IT-024
**テスト項目名**: 例外処理とエラーログ出力

| 項目 | 内容 |
|------|------|
| 前提条件 | 各画面が表示されている |
| テスト手順 | 1. 意図的に例外が発生する操作を実行（例：データベース接続エラー、ファイルアクセスエラーなど）<br>2. エラーハンドリングの動作を確認<br>3. エラーログが出力されることを確認 |
| 期待結果 | - 例外が適切にキャッチされる<br>- ユーザーに分かりやすいエラーメッセージが表示される<br>- エラーログが記録される（LogErrorメソッドが呼び出される）<br>- アプリケーションが異常終了しない |
| 判定基準 | 上記の期待結果がすべて満たされること |

### 3.7 UI表示テスト

#### テストケース ID: IT-025
**テスト項目名**: DataGridViewの表示調整

| 項目 | 内容 |
|------|------|
| 前提条件 | SalesData画面またはTransmission画面が表示されている<br>検索結果が表示されている |
| テスト手順 | 1. DataGridViewの表示を確認 |
| 期待結果 | - 列幅が適切に調整されている（横スクロールが発生しない）<br>- 最大表示行数が適切に設定されている（SalesData: 15行、Transmission: 10行）<br>- 縦スクロールが正常に動作する<br>- データが正しく表示される |
| 判定基準 | 上記の期待結果がすべて満たされること |

## 4. テスト実施計画

### 4.1 テスト実施スケジュール
- 準備期間: テスト環境構築、テストデータ準備
- 実施期間: 各テストケースの実行
- 結果確認期間: テスト結果の確認と不具合修正

### 4.2 テスト環境準備
1. テスト用データベースの構築
2. テストデータの投入
3. テスト用接続文字列の設定
4. Batch.exeの配置

### 4.3 テストデータ
- 売上データ: 複数年月、複数商品分類、複数商品のテストデータ
- 送受信ログデータ: 複数年月、複数分類・ステータスのテストデータ

## 5. テスト結果記録

### 5.1 テスト結果記録表

| テストケースID | テスト項目名 | 実施日 | 実施者 | 結果 | 備考 |
|---------------|------------|--------|--------|------|------|
| IT-001 | Top画面からSalesData画面への遷移 | - | - | - | - |
| IT-002 | Top画面からTransmission画面への遷移 | - | - | - | - |
| IT-003 | SalesData画面の初期表示 | - | - | - | - |
| IT-004 | 売上データ検索（正常系） | - | - | - | - |
| IT-005 | 売上データ検索（入力チェック：期間形式エラー） | - | - | - | - |
| IT-006 | 売上データ検索（入力チェック：商品分類未選択） | - | - | - | - |
| IT-007 | 売上データ検索（入力チェック：商品番号形式エラー） | - | - | - | - |
| IT-008 | 売上データ検索（入力チェック：商品名文字数超過） | - | - | - | - |
| IT-009 | 条件クリア機能 | - | - | - | - |
| IT-010 | 売上データ送信機能 | - | - | - | - |
| IT-011 | 売上データ送信機能（キャンセル） | - | - | - | - |
| IT-012 | 更新機能 | - | - | - | - |
| IT-013 | Transmission画面の初期表示 | - | - | - | - |
| IT-014 | 送受信ログ検索（正常系） | - | - | - | - |
| IT-015 | 送受信ログ検索（入力チェック：期間形式エラー） | - | - | - | - |
| IT-016 | 送受信ログ検索（入力チェック：分類・ステータス未選択） | - | - | - | - |
| IT-017 | 条件クリア機能 | - | - | - | - |
| IT-018 | 更新機能 | - | - | - | - |
| IT-019 | SalesData画面とTransmissionクラスのデータ連携 | - | - | - | - |
| IT-020 | SalesData画面とBatchプロセスの連携 | - | - | - | - |
| IT-021 | データベース接続（接続文字列設定時） | - | - | - | - |
| IT-022 | データベース接続（接続文字列未設定時：サンプルデータ） | - | - | - | - |
| IT-023 | データベース接続エラー処理 | - | - | - | - |
| IT-024 | 例外処理とエラーログ出力 | - | - | - | - |
| IT-025 | DataGridViewの表示調整 | - | - | - | - |

### 5.2 不具合管理
不具合が発見された場合は、別途不具合管理表に記録し、修正後に再テストを実施する。

## 6. 判定基準

### 6.1 合格基準
- すべてのテストケースが期待結果を満たすこと
- 重大な不具合（Critical）が0件であること
- 重要度の高い不具合（High）が許容範囲内であること

### 6.2 不具合の重要度定義
- **Critical**: システムが使用できない、データ損失が発生する
- **High**: 主要機能が動作しない、代替手段がない
- **Medium**: 機能に制限があるが、代替手段がある
- **Low**: 軽微な表示の問題、使い勝手の問題

## 7. 付録

### 7.1 用語集
- **内部結合テスト**: システムの各モジュール間の連携をテストすること
- **DataGridView**: Windows Formsのデータ表示コントロール
- **リターンコード**: プロセス終了時に返される終了コード（0は正常終了）

### 7.2 参考資料
- システム設計書
- 外部設計書
- データベース設計書

---

**文書履歴**

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|---------|--------|
| 2025年1月 | 1.0 | 初版作成 | - |

